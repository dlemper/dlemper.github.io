(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{179:function(e,t,s){"use strict";s.r(t);var a=s(3),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"airplay-server-on-tp-link-mr3020"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#airplay-server-on-tp-link-mr3020"}},[e._v("#")]),e._v(" AirPlay server on TP-Link MR3020")]),e._v(" "),s("p",[e._v("Or in other words: shairport on MR3020 using OpenWRT!")]),e._v(" "),s("p",[e._v("First, if you want to do it yourself and brick anything using this guide, don't make me responsible: THIS COMES WITH ABSOLUTELY NO WARRANTY!\n(However after the first few OpenWRT builds I made, some of them didn't let me connect to the MR3020 and now I know, there are some possible methods to resurrect it, e.g. OpenWRT failsafe mode and serial communication with the bootloader.)")]),e._v(" "),s("p",[e._v("It took about 3 days and some code research to get it working, and here it is:")]),e._v(" "),s("p",[e._v("Hardware requirements:")]),e._v(" "),s("ul",[s("li",[e._v("TP-Link MR3020 Wireless router")]),e._v(" "),s("li",[e._v("USB sound card (I used a Delock 61645)")])]),e._v(" "),s("p",[e._v("Installation:\nYou can download the firmware image here ("),s("a",{attrs:{href:"http://dlemper.de/shairport/openwrt-ar71xx-generic-tl-mr3020-v1-squashfs-factory.bin",title:"Factory",target:"_blank",rel:"noopener noreferrer"}},[e._v("Factory"),s("OutboundLink")],1),e._v(", "),s("a",{attrs:{href:"http://dlemper.de/shairport/openwrt-ar71xx-generic-tl-mr3020-v1-squashfs-sysupgrade.bin",title:"Sysupgrade",target:"_blank",rel:"noopener noreferrer"}},[e._v("Sysupgrade"),s("OutboundLink")],1),e._v(") and install it using the web interface of the MR3020. Be sure to use the factory image on MR3020 with original firmware, and sysupgrade only on MR3020 which already has OpenWRT on it, otherwise it may brick.\nThen, after reboot, you need to connect to it using telnet, because the LuCI webinterface is broken in this build...")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("telnet "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("192.168")]),e._v(".1.1\n")])])]),s("p",[e._v("Then, set the new root password:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("passwd")]),e._v("\n")])])]),s("p",[e._v("Now you need to setup wireless etc. As there is no webinterface, you need to login via ssh and then use the uci command, e.g.:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" root@192.168.1.1\nuci show wireless\nuci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" wireless.radio0.country"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("DE\nuci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" wireless.radio0.channel"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v("\nuci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" wireless.radio0.txpower"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\nuci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" wireless.@wifi-iface"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(".ssid"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("AirPlay\nuci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" wireless.@wifi-iface"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(".encryption"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("psk2+ccmp\nuci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" wireless.@wifi-iface"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(".key"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("secretWPAPassphrase\nuci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" wireless.@wifi-iface"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(".network"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("lan\nuci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" dhcp.lan.dhcp_option"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"3 6"')]),e._v("\nuci commit\nwifi\n")])])]),s("p",[e._v("YOU HAVE TO CHANGE THE VALUES PRESENTED ABOVE! Checkout the OpenWRT manual for help.")]),e._v(" "),s("p",[e._v("Now it's time to test the setup. Use one of your iDevices to connect to the router wirelessly. If that works, you are one big step further.\nSo, let's try out shairport itself and start it using the ssh connection:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("shairport -a AirPlayer -v2\n")])])]),s("p",[e._v("You can replace \"AirPlayer\" with the name you like to see on your iDevice as the AirPlay speakers.\nIf shairport didn't quit with an error message, you should be able to use your iDevice as an AirPlay client by now.\nJust post a comment of your shairport error message, if you got one and I'll try to help you.")]),e._v(" "),s("p",[e._v("To make shairport starting after system boot, we need to edit the "),s("code",[e._v("/etc/rc.local")]),e._v(" file, as there is no init-script for shairport at the moment. I used vi to put the command into the file, but you can also just use echo or cat for that:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v("EOF "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("/etc/rc.local\nshairport -a AirPlayer -q -d\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exit")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\nEOF\n")])])]),s("p",[e._v("The parameter "),s("code",[e._v("-q")]),e._v(" tells shairport to be quiet and "),s("code",[e._v("-d")]),e._v(" to daemonize.")]),e._v(" "),s("p",[e._v("Now you're done and can reboot the device or just unplug it and put it anywhere you want to have a streaming box.")]),e._v(" "),s("p",[e._v("Thanks goes to:")]),e._v(" "),s("ul",[s("li",[e._v("OpenWRT Team")]),e._v(" "),s("li",[e._v("Shairport Developers")]),e._v(" "),s("li",[e._v("Github user jlars for his port of shairport to OpenWRT")]),e._v(" "),s("li",[e._v("OpenWRT forum user written_direcon for his great "),s("a",{attrs:{href:"http://www.custom-openwrt-builds.info/wiki/Building_Shairport_On_OpenWrt",title:"wiki article",target:"_blank",rel:"noopener noreferrer"}},[e._v("wiki article"),s("OutboundLink")],1)])]),e._v(" "),s("p",[s("strong",[e._v("UPDATE [2014-01-26]:")])]),e._v(" "),s("p",[e._v("I've just found out how you can tell the dhcp server (dnsmasq) to not pass any gateway or dns entries. This simplifies the method of using both interfaces (3G and WiFi) of an iPhone at the same time, so you can stream music "),s("em",[e._v("and")]),e._v(" check emails or surf through the internet.\nAll you have to do (if you already have an MR3020 modified like above) is:")]),e._v(" "),s("ul",[s("li",[e._v("Connect to your MR3020 using ssh")]),e._v(" "),s("li",[e._v("type in 3 commands:")])]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("uci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" wireless.@wifi-iface"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(".network"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("lan"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),e._v("\nuci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" dhcp.lan.dhcp_option"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"3 6"')]),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v("\nuci commit\n")])])]),s("ul",[s("li",[e._v("reboot the device using either "),s("code",[e._v("reboot -f")]),e._v(" or pull the USB plug and you're done\nI've already updated the instructions above to cover these news.\nThanks for the hint goes to the people in this forum thread: http://www.dd-wrt.com/phpBB2/viewtopic.php?p=316277")])]),e._v(" "),s("p",[s("strong",[e._v("UPDATE 2 [2014-02-04]:")])]),e._v(" "),s("p",[e._v("Some users (Maciek and Evgen below in the comments) and I have the problem, that shairport seems to stutter after 3-5 minutes of playback.")]),e._v(" "),s("p",[e._v('Today I had some free time to experiment and tried out a buffer size of 148 (which should be exactly one packet transferred from my iPhone 4 to shairport). To try this out, all you need to do is, append the "-b 148" option to your shairport command (in /etc/rc.local, if you want to set that for every boot).\nWith the buffer size set to 148 I have 10 to 20 minutes without stuttering.')]),e._v(" "),s("p",[e._v("This is not a solution, just a temporary 'fix'.\nI have to compile the current master branch of the new 1.0 version of shairport for OpenWrt, but it will take some time to port... Not sure, when this will be done.")])])}),[],!1,null,null,null);t.default=r.exports}}]);